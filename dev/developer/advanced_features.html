

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Advanced Features &mdash; WEC-Sim  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="WEC-Sim Library" href="library.html" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BSPTGP3DXP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BSPTGP3DXP');
    </script>
    <jinja2.runtime.BlockReference object at 0x7f4cc6f7e070>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WEC-Sim
          

          
          </a>

          
            
            
              <div class="version">
                v5.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/index.html">Theory Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="pull_requests.html">Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_tests.html">Software Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="library.html">WEC-Sim Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#added-mass">Added Mass</a></li>
<li class="toctree-l3"><a class="reference internal" href="#morison-element">Morison Element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fixed-body">Fixed Body</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moving-body">Moving Body</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wec-sim-implementations">WEC-Sim Implementations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WEC-Sim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer Manual</a> &raquo;</li>
        
      <li>Advanced Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developer/advanced_features.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            

<p>
  <strong>
    
    You're reading the documentation for a development version.
    For the latest released version, please have a look at <a href="../../master/developer/advanced_features.html">master</a>.
    
  </strong>
</p>


  <div class="section" id="advanced-features">
<span id="dev-advanced-features"></span><h1>Advanced Features<a class="headerlink" href="#advanced-features" title="Permalink to this heading">¶</a></h1>
<div class="section" id="added-mass">
<h2>Added Mass<a class="headerlink" href="#added-mass" title="Permalink to this heading">¶</a></h2>
<p id="dev-added-mass">Added mass is a special multi-directional fluid dynamic phenomenon that most
physics software cannot account for well. WEC-Sim uses a special added mass
treatment to get around the current limitations of Simscape Multibody. For the
most robust simulation, the added mass matrix should be combined with the mass
and inertia, shown in the manipulation of the governing equation below:</p>
<div class="math notranslate nohighlight">
\[\begin{split}m\ddot{X_i} &amp;= \Sigma F(t,\omega) - A\ddot{X_i} \\
(m+A)\ddot{X_i} &amp;= \Sigma F(t,\omega) \\
M_{adjusted}\ddot{X_i} &amp;= \Sigma F(t,\omega)\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the mass, <span class="math notranslate nohighlight">\(I\)</span> is the moment of inertia, <span class="math notranslate nohighlight">\(A\)</span> is the added mass, and subscript <span class="math notranslate nohighlight">\(i\)</span> represents the timestep being solved for.
In this case, the mass of a body is set to the sum of the translational mass, rotational inertia and the added mass matrix:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted} = \begin{bmatrix}
                   m + A_{1,1} &amp; A_{1,2} &amp; A_{1,3} &amp; A_{1,4} &amp; A_{1,5} &amp; A_{1,6} \\
                   A_{2,1} &amp; m + A_{2,2} &amp; A_{2,3} &amp; A_{2,4} &amp; A_{2,5} &amp; A_{2,6} \\
                   A_{3,1} &amp; A_{3,2} &amp; m + A_{3,3} &amp; A_{3,4} &amp; A_{3,5} &amp; A_{3,6} \\
                   A_{4,1} &amp; A_{4,2} &amp; A_{4,3} &amp; I_{4,4} + A_{4,4} &amp; A_{4,5} &amp; A_{4,6} \\
                   A_{5,1} &amp; A_{5,2} &amp; A_{5,3} &amp; A_{5,4} &amp; I_{5,5} + A_{5,5} &amp; A_{5,6} \\
                   A_{6,1} &amp; A_{6,2} &amp; A_{6,3} &amp; A_{6,4} &amp; A_{6,5} &amp; I_{6,6} + A_{6,6} \\
               \end{bmatrix}\end{split}\]</div>
<p>This formulation is ideal because it removes the acceleration dependence from the right hand side of the equation.
Without this treatment, the acceleration creates an unsolvable algebraic loop.
There are ways to get around this issue, but simulation robustness and stability become more difficult.</p>
<p>The core issue with this combined mass formulation is that Simscape does not allow a generic body to have a degree-of-freedom specific mass.
A Simscape body is only allowed to have one translational mass and three values of inertia about each translational axis.</p>
<p>Due to this limitation, WEC-Sim cannot combine the mass and added mass on the left-hand side of the equation of motion (as shown above).
Instead, WEC-Sim moves some components of added mass, while the majority of the components remain on the right-hand side.
There is a 1-1 mapping between rotational inertia and the roll-roll (4,4), pitch-pitch (5,5), yaw-yaw (6,6) added mass components.
Additionally, some combination of the surge-surge (1,1), sway-sway (2,2), heave-heave (3,3) components correspond to the translational mass of the body. Therefore, WEC-Sim treats the added mass in the following way:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted} &amp;= m + \alpha Y \\\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}Y &amp;= (A_{1,1} + A_{2,2} + A_{3,3}) \\\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}I_{adjusted} &amp;= \begin{bmatrix}
                   I_{4,4} + A_{4,4} \\
                   I_{5,5} + A_{5,5} \\
                   I_{6,6} + A_{6,6} \\
               \end{bmatrix} \\
A_{adjusted} &amp;= \begin{bmatrix}
                   A_{1,1} - \alpha Y &amp; A_{1,2} &amp; A_{1,3} &amp; A_{1,4} &amp; A_{1,5} &amp; A_{1,6} \\
                   A_{2,1} &amp; A_{2,2} - \alpha Y &amp; A_{2,3} &amp; A_{2,4} &amp; A_{2,5} &amp; A_{2,6} \\
                   A_{3,1} &amp; A_{3,2} &amp; A_{3,3} - \alpha Y &amp; A_{3,4} &amp; A_{3,5} &amp; A_{3,6} \\
                   A_{4,1} &amp; A_{4,2} &amp; A_{4,3} &amp; 0 &amp; A_{4,5} &amp; A_{4,6} \\
                   A_{5,1} &amp; A_{5,2} &amp; A_{5,3} &amp; A_{5,4} &amp; 0 &amp; A_{5,6} \\
                   A_{6,1} &amp; A_{6,2} &amp; A_{6,3} &amp; A_{6,4} &amp; A_{6,5} &amp; 0\\
               \end{bmatrix}\end{split}\]</div>
<p>The factor <span class="math notranslate nohighlight">\(\alpha\)</span> represents <code class="docutils literal notranslate"><span class="pre">simu.adjMassFactor</span> <span class="pre">=2</span></code>, the default value.</p>
<p>The summation of the adjusted mass, inertia and added mass is identical to the original summation above.
The governing equation of motion does not change, only its implementation.
A simulation class weight factor controls the degree to which the added mass is adjusted to create the most robust simulation possible.
To see its effects, set <code class="docutils literal notranslate"><span class="pre">simu.adjMassFactor</span> <span class="pre">=</span> <span class="pre">0</span></code> and WEC-Sim will likely become unstable.</p>
<p>However WEC-Sim again contains an unsolvable algebraic loop due to the acceleration dependence.
WEC-Sim removes this algebraic problem using a <a class="reference external" href="https://www.mathworks.com/help/simulink/slref/transportdelay.html">Simulink Transport Delay</a> with a very small time delay (<code class="docutils literal notranslate"><span class="pre">1e-8</span></code>).
This typically results in using the acceleration at a previous time step to calculate the added mass force.
However, since the time delay is smaller than the simulation time step Simulink will extrapolate the previous step to within 1e-8 of the current time step.
This will convert the algebraic loop equation of motion to a solvable one:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted}\ddot{X_i} &amp;= \Sigma F(t,\omega) - A_{adjusted}\ddot{X}_{i - (10^{-8}/dt)} \\\end{split}\]</div>
<p>The acceleration used for the added mass represents the previous time step (<span class="math notranslate nohighlight">\(i-1\)</span>) interpolated to <code class="docutils literal notranslate"><span class="pre">1e-8</span></code> seconds before the current time step being solved.
This can be thought of as a <code class="docutils literal notranslate"><span class="pre">i-0.001%</span></code> time step; a close approximation of the current time step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on the wave formulation used, <span class="math notranslate nohighlight">\(A\)</span> can either be a function of wave frequency <span class="math notranslate nohighlight">\(A(\omega)\)</span>, or equal to the added mass at infinite wave frequency <span class="math notranslate nohighlight">\(A_{\infty}\)</span></p>
</div>
</div>
<div class="section" id="morison-element">
<h2>Morison Element<a class="headerlink" href="#morison-element" title="Permalink to this heading">¶</a></h2>
<p id="dev-morison-element">As a reminder from the WEC-Sim Theory Manual, the Morison force equation assumes that the fluid forces in an oscillating flow on a structure of slender cylinders or other similar geometries arise partly from pressure effects from potential flow and partly from viscous effects. A slender cylinder implies that the diameter, <span class="math notranslate nohighlight">\(D\)</span>, is small relative to the wave length, <span class="math notranslate nohighlight">\(\lambda\)</span>, which is generally satisfied when <span class="math notranslate nohighlight">\(D/\lambda&lt;0.1-0.2\)</span>. If this condition is not met, wave diffraction effects must be taken into account. Assuming that the geometries are slender, the resulting force can be approximated by a modified Morison formulation for each element on the body.</p>
<div class="section" id="fixed-body">
<h3>Fixed Body<a class="headerlink" href="#fixed-body" title="Permalink to this heading">¶</a></h3>
<p>For a fixed body in an oscillating flow the force imposed by the fluid is given by:</p>
<div class="math notranslate nohighlight" id="equation-fixed">
<span class="eqno">(1)<a class="headerlink" href="#equation-fixed" title="Permalink to this equation">¶</a></span>\[\vec{F}_{ME} = \underbrace{\rho \forall C_{m} \dot{\vec{u}}}_{\text{Inertia}} + \underbrace{\frac{1}{2} \rho A C_{D} \vec{u} | \vec{u} |}_{Drag}\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{F}_{ME}\)</span> is the Morison element hydrodynamic force, <span class="math notranslate nohighlight">\(\rho\)</span> is the fluid density, <span class="math notranslate nohighlight">\(\forall\)</span> is the displaced volume, <span class="math notranslate nohighlight">\(C_{m}\)</span> is the inertia coefficient, <span class="math notranslate nohighlight">\(A\)</span> is the reference area, <span class="math notranslate nohighlight">\(C_{D}\)</span> is the drag coefficient, and <span class="math notranslate nohighlight">\(u\)</span> is the fluid velocity. The inertia coefficient is defined as:</p>
<div class="math notranslate nohighlight" id="equation-inertiacoeff">
<span class="eqno">(2)<a class="headerlink" href="#equation-inertiacoeff" title="Permalink to this equation">¶</a></span>\[C_{m} = 1 + C_{a}\]</div>
<p>where <span class="math notranslate nohighlight">\(C_{a}\)</span> is the added mass coefficient. The inertia term is the sum of the Froude- Krylov Force, <span class="math notranslate nohighlight">\(\rho \forall \dot{u}\)</span>, and the hydrodynamic mass force, <span class="math notranslate nohighlight">\(\rho C_{a} \forall \dot{u}\)</span>. The inertia and drag coefficients are generally obtained experimentally and have been found to be a function of the Reynolds (Re) and Kulegan Carpenter (KC) numbers</p>
<div class="math notranslate nohighlight" id="equation-kcre">
<span class="eqno">(3)<a class="headerlink" href="#equation-kcre" title="Permalink to this equation">¶</a></span>\[\text{Re} = \frac{U_{m}D}{\nu}~~\&amp;~~ \text{KC} = \frac{U_{m}T}{D}~~\]</div>
<p>where <span class="math notranslate nohighlight">\(U_{m}\)</span> is the maximum fluid velocity,  and <span class="math notranslate nohighlight">\(\nu\)</span> is the kinematic viscosity of the fluid, and <span class="math notranslate nohighlight">\(T\)</span> is the period of oscillation.  Generally when KC is small then <span class="math notranslate nohighlight">\(\vec{F}\)</span> is dominated by the inertia term when the drag term dominates at high KC numbers.  If the fluid velocity is sinusoidal then <span class="math notranslate nohighlight">\(u\)</span> is given by:</p>
<div class="math notranslate nohighlight" id="equation-sinusoidalflow">
<span class="eqno">(4)<a class="headerlink" href="#equation-sinusoidalflow" title="Permalink to this equation">¶</a></span>\[u(t) = U_{m} \sin \left( \sigma t \right)~~\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma = 2\pi/T\)</span>.  This can be taking further by considering the body is being is impinged upon by regular waves of the form:</p>
<div class="math notranslate nohighlight" id="equation-eqna">
<span class="eqno">(5)<a class="headerlink" href="#equation-eqna" title="Permalink to this equation">¶</a></span>\[\begin{split}\eta(x,t) &amp; = A \cos \left( \sigma t - k \left[ x \cos \theta + y \sin \theta\right] \right) = \Re \left\lbrace -\frac{1}{g}\frac{\partial \phi_{I}}{\partial t} \bigg|_{z=0} \right\rbrace~~, \\ \phi_{I}(x,z,t) &amp; = \Re \left\lbrace \frac{Ag}{\sigma} \frac{\cosh \left(k (z+h) \right)}{\cosh \left( kh \right)} i e^{i(\sigma t-k\left[ x \cos \theta + y \sin \theta\right])} \right\rbrace~~, \\ \sigma^{2} &amp; = gk\tanh\left(kh\right)\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\eta\)</span> is the wave elevation, <span class="math notranslate nohighlight">\(\phi_{I}\)</span> is the incident wave potential, <span class="math notranslate nohighlight">\(A\)</span> is the wave amplitude, <span class="math notranslate nohighlight">\(k\)</span> is the wave number (defined as <span class="math notranslate nohighlight">\(k=\frac{2\pi}{\lambda}\)</span> where <span class="math notranslate nohighlight">\(\lambda\)</span> is the wave length), <span class="math notranslate nohighlight">\(g\)</span> is gravitational acceleration, <span class="math notranslate nohighlight">\(h\)</span> is the water depth, <span class="math notranslate nohighlight">\(z\)</span> is the vertical position in the water column, <span class="math notranslate nohighlight">\(\theta\)</span> is the wave heading. The fluid velocity can then be obtained by taking the graident of Eqn. <a class="reference internal" href="#equation-eqna">(5)</a> :</p>
<div class="math notranslate nohighlight" id="equation-eqnb">
<span class="eqno">(6)<a class="headerlink" href="#equation-eqnb" title="Permalink to this equation">¶</a></span>\[\begin{split}u (x,z,t) &amp; = \Re \left\lbrace \frac{\partial \phi_{I}}{\partial x} \right\rbrace = \frac{Agk}{\sigma} \frac{\cosh \left( k (z+h)\right)}{\cosh \left( kh \right)} \cos \left( \sigma t - k x \right) \cos\left(\theta\right)~~,\\
v (x,z,t) &amp; = \Re \left\lbrace \frac{\partial \phi_{I}}{\partial y} \right\rbrace = \frac{Agk}{\sigma} \frac{\cosh \left( k (z+h)\right)}{\cosh \left( kh \right)} \cos \left( \sigma t - k x \right)\sin\left(\theta\right)~~,\\
w (x,z,t) &amp; = \Re \left\lbrace \frac{\partial \phi_{I}}{\partial z} \right\rbrace = -\frac{Agk}{\sigma} \frac{\sinh \left( k (z+h)\right)}{\cosh \left( kh \right)} \sin \left( \sigma t - k x \right)~~,\end{split}\]</div>
<p>The acceleration of the fluid particles will then be obtained by taking the time derivative of Eqn. <a class="reference internal" href="#equation-eqnb">(6)</a> :</p>
<div class="math notranslate nohighlight" id="equation-dotuw">
<span class="eqno">(7)<a class="headerlink" href="#equation-dotuw" title="Permalink to this equation">¶</a></span>\[\begin{split}\dot{u} (x,z,t) &amp; = \frac{\partial u}{\partial t} = -Agk \frac{\cosh \left( k (z+h)\right)}{\cosh \left( kh \right)} \sin \left( \sigma t - k x \right) \cos\left(\theta\right)~~,\\
\dot{v} (x,z,t) &amp; = \frac{\partial v}{\partial t} = -Agk \frac{\cosh \left( k (z+h)\right)}{\cosh \left( kh \right)} \sin \left( \sigma t - k x \right) \sin\left(\theta\right)~~,\\
\dot{w} (x,z,t) &amp; = \frac{\partial w}{\partial t} = -Agk \frac{\sinh \left( k (z+h)\right)}{\cosh \left( kh \right)} \cos \left( \sigma t - k x \right)~~,\end{split}\]</div>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/HorizontalVerticalOrbitalVelocity.jpg"><img alt="../_images/HorizontalVerticalOrbitalVelocity.jpg" src="../_images/HorizontalVerticalOrbitalVelocity.jpg" style="width: 400pt;" /></a>
<p class="caption"><span class="caption-text">Horizontal and vertical orbital velocity magnitude for a wave period of 10 s and water depth of 50 m with a wave heading of 0 rads.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/MagAngleOrbitalVelocity.jpg"><img alt="../_images/MagAngleOrbitalVelocity.jpg" src="../_images/MagAngleOrbitalVelocity.jpg" style="width: 400pt;" /></a>
<p class="caption"><span class="caption-text">Orbital velocity magnitude vectors for a wave period of 10 s and water depth of 50 m with a wave heading of 0 rads.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="moving-body">
<h3>Moving Body<a class="headerlink" href="#moving-body" title="Permalink to this heading">¶</a></h3>
<p>If the body is allowed to move in an oscillating flow then Eqn. <a class="reference internal" href="#equation-fixed">(1)</a> must be adjusted as follows:</p>
<div class="math notranslate nohighlight" id="equation-moving">
<span class="eqno">(8)<a class="headerlink" href="#equation-moving" title="Permalink to this equation">¶</a></span>\[\vec{F}_{ME} = \rho \forall \dot{\vec{u}} + \rho \forall C_{a} \left( \dot{\vec{u}} - \dot{\vec{U}} \right) + \frac{1}{2}\rho C_{D} A \left( \vec{u} - \vec{U} \right) \left| \vec{u} - \vec{U} \right|~~\]</div>
<p>where <span class="math notranslate nohighlight">\(U\)</span> is the body velocity.  In the calculations performed by WEC-Sim, it is assumed that the body does not alter the wave field and the fluid velocity and acceleration can be calculated from the incident wave potential as from Eqn. <a class="reference internal" href="#equation-eqnb">(6)</a> and <a class="reference internal" href="#equation-dotuw">(7)</a>.</p>
<div class="section" id="review-of-rigid-body-dynamics">
<h4>Review of Rigid Body Dynamics<a class="headerlink" href="#review-of-rigid-body-dynamics" title="Permalink to this heading">¶</a></h4>
<p>A rigid body is an idealization of a solid body in which deformation is neglected. In other words, the distance between any two given points of a rigid body remains constant in time regardless of external forces exerted on it.  The position of the whole body is represented by its linear position together with its angular position with a global fixed reference frame.  WEC-Sim calculates the position, velocity, and acceleration of the rigid body about its center of gravity; however, the placement of each morrison element will have a different local velocity that affects the fluid force.  The relative velocity between point A and point B on a rigid body is given by:</p>
<div class="math notranslate nohighlight" id="equation-relv">
<span class="eqno">(9)<a class="headerlink" href="#equation-relv" title="Permalink to this equation">¶</a></span>\[\vec{U}_{A} = \vec{U}_{B} + \omega \times r_{BA}~~\]</div>
<p>where <span class="math notranslate nohighlight">\(\omega\)</span> is the angular velocity of the body and <span class="math notranslate nohighlight">\(\times\)</span> denotes the cross product.  Taking the time derivative of Eqn. <a class="reference internal" href="#equation-relv">(9)</a> provides the relative acceleration:</p>
<div class="math notranslate nohighlight" id="equation-rela">
<span class="eqno">(10)<a class="headerlink" href="#equation-rela" title="Permalink to this equation">¶</a></span>\[\vec{\dot{U}}_{A} = \vec{\dot{U}}_{B} + \omega \times \omega \times r_{BA} + \dot{\omega} \times r_{BA}~~\]</div>
</div>
</div>
<div class="section" id="wec-sim-implementations">
<h3>WEC-Sim Implementations<a class="headerlink" href="#wec-sim-implementations" title="Permalink to this heading">¶</a></h3>
<p>As discussed in the WEC-Sim user manual, there are two options to model a Morison element(s) and will be described here in greater detail so potential developers can modify the code to suit their modeling needs.</p>
<div class="section" id="option-1">
<h4>Option 1<a class="headerlink" href="#option-1" title="Permalink to this heading">¶</a></h4>
<p>In the first Morison element implementation option, the acceleration and velocity of the fluid flow are estimated at the Morison point of application, which can include both wave and current contributions, and then subtracts the body acceleration and velocity for the individual translational degrees of freedom (x-, y-, and z-components). The fluid flow properties are then used to calculate the Morison element force, indepenently for each degree of freedom, as shown by the following expressions:</p>
<div class="math notranslate nohighlight" id="equation-mefoption1">
<span class="eqno">(11)<a class="headerlink" href="#equation-mefoption1" title="Permalink to this equation">¶</a></span>\[\begin{split}F_{ME,x} &amp; = \rho \forall \dot{u}_{x} + \rho \forall C_{a,x} \left( \dot{u}_{x} - \dot{U}_{x} \right) + \frac{1}{2}\rho C_{D,x} A_{x} \left( u_{x} - U_{x} \right) \left| u_{x} - U_{x} \right|~~, \\
F_{ME,y} &amp; = \rho \forall \dot{u}_{y} + \rho \forall C_{a,y} \left( \dot{u}_{y} - \dot{U}_{y} \right) + \frac{1}{2}\rho C_{D,y} A_{y} \left( u_{y} - U_{y} \right) \left| u_{y} - U_{y} \right|~~, \\
F_{ME,z} &amp; = \rho \forall \dot{u}_{z} + \rho \forall C_{a,z} \left( \dot{u}_{z} - \dot{U}_{z} \right) + \frac{1}{2}\rho C_{D,z} A_{z} \left( u_{z} - U_{z} \right) \left| u_{z} - U_{z} \right|~~, \\
\vec{M} &amp; = \vec{r} \times \vec{F} = \left[ r_{g,x}, r_{g,y}, r_{g,z} \right] \times \left[ F_{x}, F_{y}, F_{z} \right]\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(r_{g}\)</span> is the lever arm from the center of gravity of the body to the Morison element point of application. Option 1 provides the most flexibility in setting independent Morison element properties for the x-, y-, and z-directions; however, a limitation arises that the fluid flow magnitude does not consider the other fluid flow components. Depending on the simulation enviroment this approach can provide the same theoretical results as taking the magnitude of the x-, y-, and z-components of the fluid flow, but is case dependent. A comparison between the outputs of Option 1 and Option 2 can be found later in the Developer Manual Morison Element documentation.</p>
</div>
<div class="section" id="option-2">
<h4>Option 2<a class="headerlink" href="#option-2" title="Permalink to this heading">¶</a></h4>
<p>The WEC-Sim Option 1 implementation solves for the of the Morison element force from the individual x-, y-, and z-components of the relative flow velocity and acceleration; however, this results in incorrect outputs at certain orientations of the flow and Morison Element. As opposed to solving for the x-, y-, and z-components of the Morison element force, the force can be calculated relative to the magnitude of the flow and distributed among its unit vector direction. Therefore the approach used in Option 2 is to decompose the fluid and body velocity and acceleration into tangential and normal components of the Morison element, as depicted in Figure <a class="reference internal" href="#fig-option-2"><span class="std std-ref">Schematic of the water flow vector decomposition reletive to the Morison Element orientation.</span></a></p>
<div class="figure align-center" id="id3">
<span id="fig-option-2"></span><a class="reference internal image-reference" href="../_images/option2Schematic.jpg"><img alt="../_images/option2Schematic.jpg" src="../_images/option2Schematic.jpg" style="width: 600pt;" /></a>
<p class="caption"><span class="caption-text">Schematic of the water flow vector decomposition reletive to the Morison Element orientation.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>In mathematics, for a given vector at a point on a surface, the vector can be uniquely decomposed into the sum of its tangential and normal components. The tangential component of the vector, <span class="math notranslate nohighlight">\(v_{\parallel}\)</span>, is parallel to the surface while the normal component of the vectors, <span class="math notranslate nohighlight">\(v_{\perp}\)</span>, is perpendicular to the surface which is used in relation to the central axis to the Morison element. The WEC-Sim input file was altered to consider a tangential and normal component for the drag coefficient [<span class="math notranslate nohighlight">\(C_{d\perp}\)</span> , <span class="math notranslate nohighlight">\(C_{d\parallel}\)</span>] , added mass coefficient [<span class="math notranslate nohighlight">\(C_{a\perp}\)</span> , <span class="math notranslate nohighlight">\(C_{a\parallel}\)</span>], characteristic area [<span class="math notranslate nohighlight">\(A_{\perp}\)</span> , <span class="math notranslate nohighlight">\(A_{\parallel}\)</span>], and the central axis vector of the ME  = [ <span class="math notranslate nohighlight">\(\vec{z} = \)</span> , <span class="math notranslate nohighlight">\(z_{y}\)</span> , <span class="math notranslate nohighlight">\(z_{z}\)</span> ].</p>
<p>A general vector, <span class="math notranslate nohighlight">\(\vec{k}\)</span>, can be decomposed into the normal component as a projection of vector k on to the central axis z as follows:</p>
<div class="math notranslate nohighlight" id="equation-parallel">
<span class="eqno">(12)<a class="headerlink" href="#equation-parallel" title="Permalink to this equation">¶</a></span>\[\vec{k}_{\parallel} = \frac{\vec{z} \cdot \vec{k}}{ || \vec{z} || } \frac{ \vec{z} }{ || \vec{z} || }\]</div>
<p>As the vector <span class="math notranslate nohighlight">\(\vec{k}\)</span> is uniquely decomposed into the sum of its tangential and normal components, the normal component can be defined as the difference between the vector <span class="math notranslate nohighlight">\(\vec{k}\)</span> and its tangential component as follows:</p>
<div class="math notranslate nohighlight" id="equation-perpendicular">
<span class="eqno">(13)<a class="headerlink" href="#equation-perpendicular" title="Permalink to this equation">¶</a></span>\[\vec{k}_{\perp} = \vec{k} - \vec{k}_{\parallel}\]</div>
<p>Using this vector multiplication, the tangential and normal components of the fluid flow can be obtained as follows:</p>
<div class="math notranslate nohighlight" id="equation-vparper">
<span class="eqno">(14)<a class="headerlink" href="#equation-vparper" title="Permalink to this equation">¶</a></span>\[\begin{split}\vec{u}_{\parallel} = \frac{\vec{z} \cdot \vec{u}}{ || \vec{z} || } \frac{ \vec{z} }{ || \vec{z} || } \\
\vec{u}_{\perp} = \vec{u}-\vec{u}_{\perp}\end{split}\]</div>
<p>The Morison element force equation for a moving body relative to the fluid flow is modified to include the following decomposition of force components and consider the magnitude of the flow:</p>
<div class="math notranslate nohighlight" id="equation-mefoption2">
<span class="eqno">(15)<a class="headerlink" href="#equation-mefoption2" title="Permalink to this equation">¶</a></span>\[\begin{split}\vec{F}_{ME} = \rho C_{M,\parallel} \forall \left( \dot{\vec{u}}_{\parallel} - \dot{\vec{U}}_{\parallel} \right) + \frac{1}{2}\rho C_{d,\parallel} \left( \vec{v}_{\parallel} - \vec{U}_{\parallel} \right) \lvert \vec{v}_{\parallel} - \vec{U}_{\parallel} \rvert + \\
\rho C_{M,\perp} \forall \left( \dot{\vec{u}}_{\perp} - \dot{\vec{U}}_{\perp} \right) + \frac{1}{2}\rho C_{d,\perp} \left( \vec{v}_{\perp} - \vec{U}_{\perp} \right) \lvert \vec{v}_{\perp} - \vec{U}_{\perp} \rvert\end{split}\]</div>
</div>
<div class="section" id="comparison-of-performance-between-option-1-and-option-2">
<h4>Comparison of Performance Between Option 1 and Option 2<a class="headerlink" href="#comparison-of-performance-between-option-1-and-option-2" title="Permalink to this heading">¶</a></h4>
<p>A simple test case, which defines a Morison element as vertical and stationary relative to horizontal fluid flow, was built to compare the Morison element force calculation between Option 1 and Option 2 within WEC-Sim. Theoretically, the magnitude of the Morison element force should remain constant as the orientation of the flow direction is rotated in the X-Y plane. The MF was calculated as the orientation of the flow was rotated about the z-axis from 1 to 360 degrees where the central axis of the ME is parallel wtih the z-axis. The remaining WEC-Sim input values for the simulation can be found in the following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Variable Type</strong></p></td>
<td><p><strong>Variable Symbol</strong></p></td>
<td><p><strong>WEC-Sim Input Values</strong></p></td>
</tr>
<tr class="row-even"><td><p>ME Central Axis</p></td>
<td><p><span class="math notranslate nohighlight">\(\vec{z}\)</span></p></td>
<td><p>[0, 0 , 1]</p></td>
</tr>
<tr class="row-odd"><td><p>Fluid flow velocity</p></td>
<td><p><span class="math notranslate nohighlight">\(\vec{U}\)</span></p></td>
<td><p>[-1, 0, 0] <span class="math notranslate nohighlight">\(m/s\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Fluid flow acceleration</p></td>
<td><p><span class="math notranslate nohighlight">\(\vec{\dot{U}}\)</span></p></td>
<td><p>[-1, 0, 0] <span class="math notranslate nohighlight">\(m/s^{2}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Drag Coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{D}\)</span></p></td>
<td><p>[1, 1, 0]</p></td>
</tr>
<tr class="row-even"><td><p>Mass Coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{a}\)</span></p></td>
<td><p>[1, 1, 0]</p></td>
</tr>
<tr class="row-odd"><td><p>Area</p></td>
<td><p><span class="math notranslate nohighlight">\(A\)</span></p></td>
<td><p>[1, 1, 0]</p></td>
</tr>
<tr class="row-even"><td><p>Density</p></td>
<td><p><span class="math notranslate nohighlight">\(\rho\)</span></p></td>
<td><p>1000 <span class="math notranslate nohighlight">\(kg/m^{3}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Displaced Volume</p></td>
<td><p><span class="math notranslate nohighlight">\(\forall\)</span></p></td>
<td><p>0.10 <span class="math notranslate nohighlight">\(m^{3}\)</span></p></td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/compPerformanceBetweenOption1Option2.png"><img alt="../_images/compPerformanceBetweenOption1Option2.png" src="../_images/compPerformanceBetweenOption1Option2.png" style="width: 500pt;" /></a>
<p class="caption"><span class="caption-text">Graphical representation of the comparison between ME Option 1 and Option 2 within WEC-Sim.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p><span class="math notranslate nohighlight">\(F_{ME,1}\)</span> and <span class="math notranslate nohighlight">\(F_{ME,2}\)</span> is the Morison element force output from Option 1 and Option 2 within WEC-Sim, respectively. Shown in the above figure, in Option 1 there is an oscillation in Morison element magnitude with flow direction while Option 2 demonstrates a constant force magnitude at any flow direction. The reason behind this performance is that Option 1 solves for the MF individually using the individual the x-, y-, and z- components of the flow while Option 2 calculates the force relative to the flow magnitude and distributed among the normal and tangential unit vectors of the flow.</p>
</div>
</div>
</div>
</div>



           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="library.html" class="btn btn-neutral float-left" title="WEC-Sim Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, National Renewable Energy Laboratory and National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: dev
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="advanced_features.html">dev</a></dd>
      <dd><a href="../../master/developer/advanced_features.html">master</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-88158104-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>